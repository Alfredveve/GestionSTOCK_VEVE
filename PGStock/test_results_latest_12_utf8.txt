py : Creating test database for alias 
'default'...
Au caractère Ligne:1 : 1
+ py manage.py test 
--settings=PGStock.test_settings 
--noinput > test_r ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecif 
   ied: (Creating test d...as 'default  
  '...:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCom 
   mandError
 

Found 151 test(s).
System check identified no issues (0 silenced).
........................................
................C:\Users\codeshester0011
\AppData\Local\Programs\Python\Python312
\Lib\site-packages\django\db\models\fiel
ds\__init__.py:1665: RuntimeWarning: 
DateTimeField Notification.created_at 
received a naive datetime (2025-10-17 
06:52:24.111204) while time zone 
support is active.
  warnings.warn(
C:\Users\codeshester0011\AppData\Local\P
rograms\Python\Python312\Lib\site-packag
es\django\db\models\fields\__init__.py:1
665: RuntimeWarning: DateTimeField 
Notification.created_at received a 
naive datetime (2025-10-27 
06:52:24.113427) while time zone 
support is active.
  warnings.warn(
DEBUG: StockMovement exit: removing 5 from Test POS Ana
DEBUG: StockMovement exit: removing 5 from Test POS Ana
DEBUG: StockMovement exit: removing 5 from Test POS Ana
DEBUG: StockMovement exit: removing 5 from Test POS Ana
DEBUG: StockMovement exit: removing 5 from Test POS Ana
DEBUG: StockMovement exit: removing 5 from Test POS Ana
DEBUG: StockMovement exit: removing 5 from Test POS Ana
DEBUG: StockMovement exit: removing 5 from Test POS Ana
DEBUG: StockMovement exit: removing 5 from Test POS Ana
DEBUG: StockMovement exit: removing 5 from Test POS Ana
DEBUG: StockMovement entry: adding 50 to Test POS Exp
DEBUG: StockMovement entry: adding 50 to Test POS Rep
DEBUG: StockMovement exit: removing 5 from Test POS
DEBUG: StockMovement exit: removing 10 from Test POS Sales
DEBUG: StockMovement return: adding 10 to Test POS Sales
DEBUG: StockMovement transfer: removing 20 from POS Stock 1
DEBUG: StockMovement transfer: adding 20 to POS Stock 2
DEBUG: StockMovement exit: removing 5 from Magasin Principal
DEBUG: StockMovement exit: removing 20 from Magasin Principal
DEBUG: StockMovement entry: adding 240 to Entrep¶t Central
DEBUG: StockMovement exit: removing 10 from Entrep¶t Central
DEBUG: StockMovement transfer: removing 120 from Entrep¶t Central
DEBUG: StockMovement transfer: adding 120 to Magasin Principal
DEBUG: StockMovement exit: removing 10 from Test POS Ord
DEBUG: StockMovement return: adding 10 to Test POS Ord
DEBUG: StockMovement exit: removing 10 from Test POS Ord
DEBUG: StockMovement return: adding 10 to Test POS Ord
DEBUG: StockMovement exit: removing 10 from Test POS Ord
DEBUG: StockMovement exit: removing 10 from Test POS Ord
DEBUG: StockMovement exit: removing 10 from Test POS Ord
DEBUG: StockMovement exit: removing 10 from Test POS Ord
DEBUG: StockMovement exit: removing 10 from Test POS Ord
DEBUG: StockMovement return: adding 10 to Test POS Ord
DEBUG: StockMovement exit: removing 5 from Magasin de Test Unique
DEBUG: StockMovement return: adding 5 to Magasin de Test Unique
DEBUG: StockMovement exit: removing 1 from Magasin de Test Unique
DEBUG: StockMovement exit: removing 10 from Magasin de Test Unique
DEBUG: StockMovement entry: adding 10 to Test Store Imm
DEBUG: StockMovement entry: adding 10 to Test Store Imm
DEBUG: StockMovement entry: adding 10 to Test Store Imm
DEBUG: StockMovement exit: removing 10 from Test Store Adv
DEBUG: StockMovement return: adding 10 to Test Store Adv
DEBUG: StockMovement entry: adding 20 to Test Store Adv
DEBUG: StockMovement exit: removing 20 from Test Store Adv
DEBUG: StockMovement entry: adding 10 to Shop Central
DEBUG: StockMovement exit: removing 2 from Shop Central
DEBUG: StockMovement return: adding 2 to Shop Central
DEBUG: StockMovement exit: removing 1 from Shop Central
DEBUG: StockMovement entry: adding 20 to Warehouse Main
DEBUG: StockMovement exit: removing 20 from Warehouse Main
DEBUG: StockMovement entry: adding 100 to Warehouse Main
DEBUG: StockMovement transfer: removing 20 from Warehouse Main
DEBUG: StockMovement transfer: adding 20 to Shop Central
DEBUG: StockMovement exit: removing 5 from Shop Central
DEBUG: StockMovement entry: adding 50 to Warehouse Main
DEBUG: StockMovement entry: adding 50 to Main Warehouse
DEBUG: Catching exception in handler: ValidationError
DEBUG: StockMovement transfer: removing 10 from Main Warehouse
DEBUG: StockMovement transfer: adding 10 to Store 1
DEBUG: StockMovement exit: removing 5 from Magasin Facture
DEBUG: deduct_stock skipped (already deducted) for INV-2026-00001
DEBUG: restore_stock starting for INV-2026-00001
DEBUG: calling process_return for Produit Test Inv, quantity 5
DEBUG: StockMovement return: adding 5 to Magasin Facture
DEBUG: StockMovement exit: removing 5 from Magasin Facture
DEBUG: StockMovement exit: removing 5 from Magasin Facture
DEBUG: deduct_stock skipped (already deducted) for INV-2026-00001
DEBUG: StockMovement entry: adding 10 to Magasin Stock
DEBUG: StockMovement entry: adding 10 to Magasin Stock
DEBUG: StockMovement entry: adding 20 to Magasin Stock
DEBUG: StockMovement transfer: removing 5 from Magasin Stock
DEBUG: StockMovement transfer: adding 5 to Magasin 2 Stock
DEBUG: StockMovement entry: adding 50 to Store WH Cons
DEBUG: StockMovement transfer: removing 20 from Store WH Cons
DEBUG: StockMovement transfer: adding 20 to Store Main Cons
DEBUG: StockMovement exit: removing 5 from Store Main Cons
DEBUG: StockMovement entry: adding 10 to Store Main Cons
DEBUG: StockMovement exit: removing 3 from Store Main Cons
DEBUG: StockMovement transfer: removing 5 from Store WH Cons
DEBUG: StockMovement transfer: adding 5 to Store Main Cons
DEBUG: Entering deduct_stock for Order CMD-2026-000001
DEBUG: StockMovement exit: removing 5 from POS 1
DEBUG: Entering deduct_stock for Order CMD-2026-000001
DEBUG: StockMovement exit: removing 5 from POS 1
DEBUG: StockMovement return: adding 5 to POS 1
DEBUG: Entering deduct_stock for Order CMD-2026-000001
DEBUG: StockMovement exit: removing 5 from POS 1
DEBUG: Entering deduct_stock for Order CMD-2026-000001
DEBUG: Stock already deducted for Order CMD-2026-000001
DEBUG: Entering deduct_stock for Order GROS-2026-000001
DEBUG: StockMovement exit: removing 24 from POS 1
DEBUG: StockMovement entry: adding 50 to Magasin 1
DEBUG: StockMovement entry: adding 10 to Magasin 1
DEBUG: StockMovement transfer: removing 20 from Entrep¶t
DEBUG: StockMovement transfer: adding 20 to Magasin 1
........................................
........................F...............
...............
========================================
==============================
FAIL: 
test_cancel_invoice_restores_stock (inve
ntory.tests_services.InvoiceServiceTest.
test_cancel_invoice_restores_stock)
Test that cancelling an invoice 
restores stock
----------------------------------------
------------------------------
Traceback (most recent call last):
  File "C:\Users\codeshester0011\Desktop
\GestionSTOCK\PGStock\inventory\tests_se
rvices.py", line 248, in 
test_cancel_invoice_restores_stock
    
self.assertEqual(inventory.quantity, 
Decimal('100'))
AssertionError: 95 != Decimal('100')

----------------------------------------
------------------------------
Ran 151 tests in 3.454s

FAILED (failures=1)
Destroying test database for alias 
'default'...

