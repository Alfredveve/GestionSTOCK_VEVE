{% extends 'inventory/base_auth.html' %}
{% load static %}


{% block content_auth %}
<form method="post" novalidate id="kt_new_password_form">
    {% csrf_token %}

    <!-- Heading -->
    <div class="text-center mb-4">
        <h2 class="text-dark fw-bold mb-3">Nouveau mot de passe</h2>
        <div class="text-secondary small">
            Votre identité a été vérifiée.
            Choisissez un nouveau mot de passe fort.
        </div>
    </div>

    <!-- Non-field errors -->
    {% if form.non_field_errors %}
    <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
        <i class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2"></i>
        <div>{{ form.non_field_errors|join:", " }}</div>
    </div>
    {% endif %}

    <!-- New Password Field -->
    <div class="form-floating mb-3">
        <input type="password" class="form-control" id="floatingNewPassword"
               name="{{ form.new_password.name }}" placeholder="Nouveau mot de passe" autocomplete="off"
                style="color: #1e1e2d;">
        <label for="floatingNewPassword">Nouveau mot de passe</label>
        
        <div class="form-text mt-2 small">
            Utilisez 8 caractères ou plus avec un mélange de lettres, de chiffres et de symboles.
        </div>
        
        {% if form.new_password.errors %}
        <div class="text-danger mt-1 small">
            {{ form.new_password.errors.0 }}
        </div>
        {% endif %}
    </div>

    <!-- Confirm Password Field -->
    <div class="form-floating mb-4">
        <input type="password" class="form-control" id="floatingConfirmPassword"
               name="{{ form.confirm_password.name }}" placeholder="Confirmer le mot de passe" autocomplete="off"
               style="color: #1e1e2d;">
        <label for="floatingConfirmPassword">Confirmer le mot de passe</label>
        
        {% if form.confirm_password.errors %}
        <div class="text-danger mt-1 small">
            {{ form.confirm_password.errors.0 }}
        </div>
        {% endif %}
    </div>

    <!-- Actions -->
    <div class="d-grid">
        <button type="submit" id="kt_new_password_submit" class="btn btn-lg btn-nature">
            <span class="indicator-label">Réinitialiser le mot de passe</span>
            <span class="indicator-progress d-none">Patientez...
                <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
            </span>
        </button>
    </div>
</form>

<script>
    document.getElementById('kt_new_password_form').addEventListener('submit', function(e) {
        var btn = document.getElementById('kt_new_password_submit');
        var label = btn.querySelector('.indicator-label');
        var progress = btn.querySelector('.indicator-progress');

        if (btn && label && progress) {
            btn.setAttribute('disabled', 'disabled');
            label.classList.add('d-none');
            progress.classList.remove('d-none');
        }
    });
</script>
{% endblock %}
