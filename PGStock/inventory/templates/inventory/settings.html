{% extends 'inventory/base.html' %}

{% block title %}Paramètres - GestionSTOCK{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h2 fw-bold text-white mb-1">
                <i class="fas fa-cog me-2 text-primary"></i>Paramètres
            </h1>
            <p class="text-secondary mb-0">Gérez votre profil et les préférences de l'application</p>
        </div>
    </div>

    <!-- Nav Tabs -->
    <ul class="nav nav-pills nav-fill mb-4 p-2 bg-dark rounded-3 border border-secondary" id="settingsTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active d-flex align-items-center justify-content-center gap-2" id="company-tab" data-bs-toggle="pill" data-bs-target="#company" type="button" role="tab">
                <i class="fas fa-building"></i>
                <span>Entreprise</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link d-flex align-items-center justify-content-center gap-2" id="profile-tab" data-bs-toggle="pill" data-bs-target="#profile" type="button" role="tab">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link d-flex align-items-center justify-content-center gap-2" id="security-tab" data-bs-toggle="pill" data-bs-target="#security" type="button" role="tab">
                <i class="fas fa-shield-alt"></i>
                <span>Sécurité</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link d-flex align-items-center justify-content-center gap-2" id="system-tab" data-bs-toggle="pill" data-bs-target="#system" type="button" role="tab">
                <i class="fas fa-info-circle"></i>
                <span>Système</span>
            </button>
        </li>
        {% if user.is_superuser %}
        <li class="nav-item" role="presentation">
            <button class="nav-link d-flex align-items-center justify-content-center gap-2 text-danger" id="danger-tab" data-bs-toggle="pill" data-bs-target="#danger" type="button" role="tab">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Zone Danger</span>
            </button>
        </li>
        {% endif %}
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="settingsTabsContent">
        <!-- Company Tab -->
        <div class="tab-pane fade show active" id="company" role="tabpanel">
            <div class="card bg-dark border-secondary shadow-lg">
                <div class="card-header bg-gradient py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle bg-white bg-opacity-25 p-3 me-3">
                            <i class="fas fa-building fa-lg text-white"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1 text-white fw-bold">Paramètres de l'Entreprise</h5>
                            <p class="card-text text-white-50 small mb-0">Configurez les informations globales de votre entreprise</p>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="row g-4">
                            <!-- Left Column -->
                            <div class="col-lg-7">
                                <div class="mb-4">
                                    <label class="form-label text-light fw-semibold">
                                        <i class="fas fa-building me-2 text-primary"></i>Nom de l'Entreprise
                                        <span class="text-danger">*</span>
                                    </label>
                                    {{ settings_form.company_name }}
                                    <div class="form-text text-secondary">Ce nom apparaîtra dans la barre de navigation et sur tous les documents</div>
                                </div>

                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label text-light fw-semibold">
                                            <i class="fas fa-globe me-2 text-info"></i>Langue
                                        </label>
                                        {{ settings_form.language }}
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label text-light fw-semibold">
                                            <i class="fas fa-coins me-2 text-warning"></i>Devise
                                        </label>
                                        {{ settings_form.currency }}
                                        <div class="form-text text-secondary">Devise pour les devis et factures</div>
                                    </div>
                                </div>

                                <div class="mt-4">
                                    <div class="form-check form-switch bg-secondary bg-opacity-25 p-3 ps-5 rounded-3 border border-secondary">
                                        {{ settings_form.email_notifications }}
                                        <label class="form-check-label text-light ms-2" for="{{ settings_form.email_notifications.id_for_label }}">
                                            <i class="fas fa-envelope me-2 text-success"></i>Notifications par Email
                                        </label>
                                        <div class="form-text text-secondary ms-4 ps-3">Recevoir les notifications importantes par email</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column: Logo -->
                            <div class="col-lg-5">
                                <label class="form-label text-light fw-semibold">
                                    <i class="fas fa-image me-2 text-purple"></i>Logo de l'Entreprise
                                </label>
                                <div class="border border-secondary border-2 border-dashed rounded-3 p-4 text-center bg-secondary bg-opacity-10">
                                    {% if settings_form.instance.company_logo %}
                                    <img src="{{ settings_form.instance.company_logo.url }}" alt="Logo actuel" 
                                         class="img-fluid rounded-3 mb-3 shadow" style="max-height: 150px; background: white; padding: 10px;">
                                    <p class="text-light mb-1 fw-semibold">Logo actuel</p>
                                    <p class="text-secondary small mb-3">Cliquez pour remplacer</p>
                                    {% else %}
                                    <div class="py-4">
                                        <i class="fas fa-cloud-upload-alt fa-3x text-secondary mb-3"></i>
                                        <p class="text-light mb-1 fw-semibold">Télécharger un logo</p>
                                        <p class="text-secondary small mb-0">Format: PNG, JPG • Taille: 200×200px</p>
                                    </div>
                                    {% endif %}
                                    <div class="mt-3">
                                        {{ settings_form.company_logo }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr class="border-secondary my-4">

                        <div class="d-flex justify-content-end">
                            <button type="submit" class="btn btn-primary btn-lg px-5 shadow">
                                <i class="fas fa-save me-2"></i>Enregistrer les paramètres
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div class="tab-pane fade" id="profile" role="tabpanel">
            <div class="card bg-dark border-secondary shadow-lg">
                <div class="card-header bg-gradient py-3" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%) !important;">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle bg-white bg-opacity-25 p-3 me-3">
                            <i class="fas fa-user fa-lg text-white"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1 text-white fw-bold">Profil Utilisateur</h5>
                            <p class="card-text text-white-50 small mb-0">Gérez vos informations personnelles</p>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    <form method="post" action="{% url 'inventory:update_profile' %}">
                        {% csrf_token %}
                        <div class="row g-4">
                            <div class="col-md-6">
                                <label class="form-label text-light fw-semibold">
                                    <i class="fas fa-user-tag me-2 text-secondary"></i>Nom d'utilisateur
                                </label>
                                <input type="text" class="form-control bg-secondary bg-opacity-25 border-secondary text-light" value="{{ user.username }}" disabled>
                                <div class="form-text text-secondary">Le nom d'utilisateur ne peut pas être modifié</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label text-light fw-semibold">
                                    <i class="fas fa-envelope me-2 text-info"></i>Email
                                </label>
                                <input type="email" name="email" class="form-control bg-secondary bg-opacity-25 border-secondary text-light" value="{{ user.email }}" placeholder="votre@email.com">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label text-light fw-semibold">
                                    <i class="fas fa-id-card me-2 text-success"></i>Prénom
                                </label>
                                <input type="text" name="first_name" class="form-control bg-secondary bg-opacity-25 border-secondary text-light" value="{{ user.first_name }}" placeholder="Votre prénom">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label text-light fw-semibold">
                                    <i class="fas fa-id-card me-2 text-success"></i>Nom
                                </label>
                                <input type="text" name="last_name" class="form-control bg-secondary bg-opacity-25 border-secondary text-light" value="{{ user.last_name }}" placeholder="Votre nom">
                            </div>
                        </div>

                        <hr class="border-secondary my-4">

                        <div class="d-flex justify-content-end">
                            <button type="submit" class="btn btn-success btn-lg px-5 shadow">
                                <i class="fas fa-save me-2"></i>Mettre à jour le profil
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Security Tab -->
        <div class="tab-pane fade" id="security" role="tabpanel">
            <div class="card bg-dark border-secondary shadow-lg">
                <div class="card-header bg-gradient py-3" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle bg-white bg-opacity-25 p-3 me-3">
                            <i class="fas fa-shield-alt fa-lg text-white"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1 text-white fw-bold">Sécurité du Compte</h5>
                            <p class="card-text text-white-50 small mb-0">Protégez votre compte avec un mot de passe fort</p>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    <form method="post" action="{% url 'inventory:change_password' %}">
                        {% csrf_token %}
                        <div class="row g-4">
                            <div class="col-lg-6">
                                <div class="mb-4">
                                    <label class="form-label text-light fw-semibold">
                                        <i class="fas fa-lock me-2 text-warning"></i>{{ password_form.current_password.label }}
                                    </label>
                                    {{ password_form.current_password }}
                                    {% if password_form.current_password.errors %}
                                        {% for error in password_form.current_password.errors %}
                                        <div class="text-danger small mt-1"><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    {% endif %}
                                </div>

                                <div class="mb-4">
                                    <label class="form-label text-light fw-semibold">
                                        <i class="fas fa-key me-2 text-success"></i>{{ password_form.new_password.label }}
                                    </label>
                                    {{ password_form.new_password }}
                                    <div class="form-text text-secondary">{{ password_form.new_password.help_text }}</div>
                                    {% if password_form.new_password.errors %}
                                        {% for error in password_form.new_password.errors %}
                                        <div class="text-danger small mt-1"><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    {% endif %}
                                </div>

                                <div class="mb-4">
                                    <label class="form-label text-light fw-semibold">
                                        <i class="fas fa-check-circle me-2 text-info"></i>{{ password_form.confirm_password.label }}
                                    </label>
                                    {{ password_form.confirm_password }}
                                    {% if password_form.confirm_password.errors %}
                                        {% for error in password_form.confirm_password.errors %}
                                        <div class="text-danger small mt-1"><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</div>
                                        {% endfor %}
                                    {% endif %}
                                </div>

                                {% if password_form.non_field_errors %}
                                <div class="alert alert-danger d-flex align-items-center" role="alert">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <div>
                                        {% for error in password_form.non_field_errors %}{{ error }}{% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>

                            <div class="col-lg-6">
                                <div class="bg-secondary bg-opacity-10 rounded-3 p-4 border border-secondary h-100">
                                    <h6 class="text-light fw-bold mb-3"><i class="fas fa-lightbulb me-2 text-warning"></i>Conseils de sécurité</h6>
                                    <ul class="list-unstyled mb-0">
                                        <li class="d-flex align-items-start mb-3 text-secondary">
                                            <i class="fas fa-check-circle text-success me-2 mt-1"></i>
                                            <span>Utilisez au moins 8 caractères avec majuscules, minuscules et chiffres</span>
                                        </li>
                                        <li class="d-flex align-items-start mb-3 text-secondary">
                                            <i class="fas fa-check-circle text-success me-2 mt-1"></i>
                                            <span>Évitez les mots de passe évidents comme "123456" ou "password"</span>
                                        </li>
                                        <li class="d-flex align-items-start mb-3 text-secondary">
                                            <i class="fas fa-check-circle text-success me-2 mt-1"></i>
                                            <span>Changez votre mot de passe régulièrement</span>
                                        </li>
                                        <li class="d-flex align-items-start text-secondary">
                                            <i class="fas fa-check-circle text-success me-2 mt-1"></i>
                                            <span>N'utilisez pas le même mot de passe sur plusieurs sites</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <hr class="border-secondary my-4">

                        <div class="d-flex justify-content-end">
                            <button type="submit" class="btn btn-warning btn-lg px-5 shadow text-dark">
                                <i class="fas fa-key me-2"></i>Changer le mot de passe
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- System Tab -->
        <div class="tab-pane fade" id="system" role="tabpanel">
            <div class="row g-4">
                <!-- Stats Cards -->
                <div class="col-lg-8">
                    <div class="card bg-dark border-secondary shadow-lg h-100">
                        <div class="card-header bg-gradient py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;">
                            <div class="d-flex align-items-center">
                                <div class="rounded-circle bg-white bg-opacity-25 p-3 me-3">
                                    <i class="fas fa-chart-bar fa-lg text-white"></i>
                                </div>
                                <div>
                                    <h5 class="card-title mb-1 text-white fw-bold">Statistiques de l'Application</h5>
                                    <p class="card-text text-white-50 small mb-0">Vue d'ensemble de vos données</p>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="row g-3">
                                <div class="col-6 col-md-4">
                                    <div class="bg-secondary bg-opacity-10 rounded-3 p-3 text-center border border-secondary h-100">
                                        <i class="fas fa-code-branch fa-2x text-primary mb-2"></i>
                                        <div class="text-secondary small text-uppercase mb-1">Version</div>
                                        <div class="text-light fw-bold fs-4">1.0.0</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-4">
                                    <div class="bg-secondary bg-opacity-10 rounded-3 p-3 text-center border border-secondary h-100">
                                        <i class="fas fa-database fa-2x text-info mb-2"></i>
                                        <div class="text-secondary small text-uppercase mb-1">Base de données</div>
                                        <div class="text-light fw-bold fs-4">SQLite</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-4">
                                    <div class="bg-secondary bg-opacity-10 rounded-3 p-3 text-center border border-secondary h-100">
                                        <i class="fas fa-box fa-2x text-success mb-2"></i>
                                        <div class="text-secondary small text-uppercase mb-1">Produits</div>
                                        <div class="text-light fw-bold fs-4">{{ total_products }}</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-4">
                                    <div class="bg-secondary bg-opacity-10 rounded-3 p-3 text-center border border-secondary h-100">
                                        <i class="fas fa-tags fa-2x text-warning mb-2"></i>
                                        <div class="text-secondary small text-uppercase mb-1">Catégories</div>
                                        <div class="text-light fw-bold fs-4">{{ total_categories }}</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-4">
                                    <div class="bg-secondary bg-opacity-10 rounded-3 p-3 text-center border border-secondary h-100">
                                        <i class="fas fa-exchange-alt fa-2x text-purple mb-2"></i>
                                        <div class="text-secondary small text-uppercase mb-1">Mouvements</div>
                                        <div class="text-light fw-bold fs-4">{{ total_movements }}</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-4">
                                    <div class="bg-secondary bg-opacity-10 rounded-3 p-3 text-center border border-secondary h-100">
                                        <i class="fas fa-server fa-2x text-danger mb-2"></i>
                                        <div class="text-secondary small text-uppercase mb-1">Framework</div>
                                        <div class="text-light fw-bold fs-4">Django</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- About -->
                <div class="col-lg-4">
                    <div class="card bg-dark border-secondary shadow-lg h-100">
                        <div class="card-header bg-gradient py-3" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%) !important;">
                            <div class="d-flex align-items-center">
                                <div class="rounded-circle bg-white bg-opacity-25 p-3 me-3">
                                    <i class="fas fa-info-circle fa-lg text-white"></i>
                                </div>
                                <div>
                                    <h5 class="card-title mb-1 text-white fw-bold">À propos</h5>
                                    <p class="card-text text-white-50 small mb-0">GestionSTOCK</p>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <p class="text-secondary">Application de gestion de stock moderne et intuitive.</p>
                            
                            <h6 class="text-light fw-bold mb-3 mt-4">Fonctionnalités</h6>
                            <div class="d-flex flex-column gap-2">
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success rounded-circle me-2" style="width: 8px; height: 8px; padding: 0;"></span>
                                    <span class="text-secondary small">Gestion des produits</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success rounded-circle me-2" style="width: 8px; height: 8px; padding: 0;"></span>
                                    <span class="text-secondary small">Suivi des mouvements</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success rounded-circle me-2" style="width: 8px; height: 8px; padding: 0;"></span>
                                    <span class="text-secondary small">Gestion fournisseurs/clients</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success rounded-circle me-2" style="width: 8px; height: 8px; padding: 0;"></span>
                                    <span class="text-secondary small">Facturation et devis</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success rounded-circle me-2" style="width: 8px; height: 8px; padding: 0;"></span>
                                    <span class="text-secondary small">Tableaux de bord</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success rounded-circle me-2" style="width: 8px; height: 8px; padding: 0;"></span>
                                    <span class="text-secondary small">Rapports et exports</span>
                                </div>
                            </div>

                            <div class="mt-4 pt-3 border-top border-secondary">
                                <p class="text-secondary small mb-0 text-center">© 2025 GestionSTOCK. Tous droits réservés.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Danger Zone Tab -->
        {% if user.is_superuser %}
        <div class="tab-pane fade" id="danger" role="tabpanel">
            <div class="card bg-dark border-danger shadow-lg">
                <div class="card-header bg-gradient py-3" style="background: linear-gradient(135deg, #cb2d3e 0%, #ef473a 100%) !important;">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle bg-white bg-opacity-25 p-3 me-3">
                            <i class="fas fa-exclamation-triangle fa-lg text-white"></i>
                        </div>
                        <div>
                            <h5 class="card-title mb-1 text-white fw-bold">Zone de Danger</h5>
                            <p class="card-text text-white-50 small mb-0">Actions irréversibles - Procédez avec prudence</p>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    <div class="alert alert-danger d-flex border-danger bg-danger bg-opacity-25" role="alert">
                        <i class="fas fa-radiation fa-2x me-3 text-white"></i>
                        <div>
                            <h6 class="alert-heading text-white fw-bold">Attention !</h6>
                            <p class="mb-0 text-white">
                                Cette action effacera <strong>toutes les données commerciales</strong> de votre application : 
                                produits, catégories, mouvements de stock, clients, fournisseurs, factures et bons de réception.
                                <br><strong>Cette opération est irréversible.</strong>
                            </p>
                        </div>
                    </div>

                    <div class="mt-4">
                        <a href="{% url 'inventory:reset_data' %}" class="btn btn-outline-danger btn-lg w-100 py-3">
                            <i class="fas fa-trash-alt me-2"></i>Réinitialiser toutes les données
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Custom styles for settings page */
    .nav-pills .nav-link {
        color: #a1a5b7;
        border-radius: 0.5rem;
        transition: all 0.3s ease;
    }
    
    .nav-pills .nav-link:hover {
        color: #fff;
        background-color: rgba(255, 255, 255, 0.1);
    }
    
    .nav-pills .nav-link.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .nav-pills .nav-link.text-danger:hover {
        background-color: rgba(220, 53, 69, 0.2);
    }
    
    .border-dashed {
        border-style: dashed !important;
    }
    
    .form-control, .form-select {
        background-color: rgba(108, 117, 125, 0.15) !important;
        border-color: #3f4254 !important;
        color: #fff !important;
    }
    
    .form-control:focus, .form-select:focus {
        background-color: rgba(108, 117, 125, 0.25) !important;
        border-color: #667eea !important;
        box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25) !important;
        color: #fff !important;
    }
    
    .form-control::placeholder {
        color: #6c757d !important;
    }
    
    .form-check-input:checked {
        background-color: #667eea;
        border-color: #667eea;
    }
    
    .text-purple {
        color: #a855f7 !important;
    }
    
    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-2px);
    }
</style>
{% endblock %}