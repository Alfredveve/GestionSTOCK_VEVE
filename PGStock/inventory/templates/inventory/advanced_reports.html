{% extends 'inventory/base.html' %}
{% load inventory_extras %}
{% load static %}

{% block title %}Rapports Avancés - GestionSTOCK{% endblock %}

{% block content %}
<div class="container-fluid py-4 fade-in">
    <!-- Modern Header with Gradient -->
    <div class="modern-header mb-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
            <div>
                <h1 class="text-white fw-bold d-flex align-items-center mb-1 gap-2">
                    <span class="symbol symbol-35px me-2">
                        <span class="symbol-label bg-white text-primary rounded-circle">
                            <i class="fas fa-chart-line fs-4"></i>
                        </span>
                    </span>
                    Rapports Avancés
                </h1>
                <span class="text-white opacity-75 fs-6 fw-bold">Analyse complète de votre activité</span>
            </div>
            <div class="d-flex gap-2 mt-3 mt-md-0">
                <button onclick="window.print()" class="btn btn-custom btn-white btn-active-light-primary text-primary fw-bold btn-sm d-print-none">
                    <i class="fas fa-print me-2"></i> Imprimer
                </button>
            </div>
        </div>
    </div>

    <!-- Premium Filter Card -->
    <div class="card card-premium mb-6 d-print-none">
        <div class="card-body p-5">
            <form method="get" class="d-flex align-items-end gap-4 flex-wrap">
                <div class="d-flex flex-column flex-fill" style="min-width: 200px;">
                    <label class="form-label fs-6 fw-bold text-gray-700 mb-2">
                        <i class="fas fa-calendar-day text-info me-2"></i>Journée précise
                    </label>
                    <input type="date" name="date" class="form-control form-control-modern" 
                        value="{{ specific_date|default:'' }}">
                </div>
                <div class="d-flex flex-column flex-fill" style="min-width: 200px;">
                    <label class="form-label fs-6 fw-bold text-gray-700 mb-2">
                        <i class="fas fa-calendar-alt text-primary me-2"></i>Date de début
                    </label>
                    <input type="date" name="start_date" class="form-control form-control-modern" 
                        value="{{ start_date|date:'Y-m-d'|default:'' }}">
                </div>
                <div class="d-flex flex-column flex-fill" style="min-width: 200px;">
                    <label class="form-label fs-6 fw-bold text-gray-700 mb-2">
                        <i class="fas fa-calendar-check text-primary me-2"></i>Date de fin
                    </label>
                    <input type="date" name="end_date" class="form-control form-control-modern" 
                        value="{{ end_date|date:'Y-m-d'|default:'' }}">
                </div>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary btn-modern px-6">
                        <i class="fas fa-search me-2"></i> Filtrer
                    </button>
                    {% if start_date or end_date or specific_date %}
                    <a href="{% url 'inventory:advanced_reports' %}" class="btn btn-light-danger btn-modern px-4" 
                       title="Effacer les filtres">
                        <i class="fas fa-times"></i>
                    </a>
                    {% endif %}
                </div>
            </form>
            {% if start_date or end_date %}
            <div class="mt-3">
                <span class="badge badge-glass-primary">
                    <i class="fas fa-filter me-1"></i>
                    Période: {{ start_date|date:"d/m/Y"|default:"Début" }} - {{ end_date|date:"d/m/Y"|default:"Aujourd'hui" }}
                </span>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="row g-6">
        <!-- 1. Activités Récentes des Ventes -->
        <div class="col-12">
            <div class="card card-modern card-flush h-xl-100">
                <div class="card-header-modern">
                    <div class="d-flex align-items-center gap-3">
                        <div class="symbol symbol-50px">
                            <span class="symbol-label bg-gradient-success">
                                <i class="fas fa-shopping-cart text-white fs-2"></i>
                            </span>
                        </div>
                        <div>
                            <h3 class="card-title-modern mb-1">Activités Récentes des Ventes</h3>
                            <span class="card-subtitle-modern">Historique des transactions</span>
                        </div>
                    </div>
                    <div class="card-toolbar d-print-none">
                        <a href="{% url 'inventory:export_sales_activities_excel' %}?{{ request.GET.urlencode }}"
                            class="btn btn-sm btn-light-success me-2 btn-hover-scale">
                            <i class="fas fa-file-excel me-1"></i> Excel
                        </a>
                        <a href="{% url 'inventory:export_sales_activities_pdf' %}?{{ request.GET.urlencode }}"
                            class="btn btn-sm btn-light-danger btn-hover-scale" target="_blank">
                            <i class="fas fa-file-pdf me-1"></i> PDF
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-modern align-middle table-row-dashed fs-6 gy-3">
                            <thead>
                                <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                                    <th class="min-w-100px">Date</th>
                                    <th class="min-w-100px">N° Facture</th>
                                    <th class="min-w-150px">Client</th>
                                    <th class="min-w-150px">Produit</th>
                                    <th class="text-end min-w-100px">Quantité</th>
                                    <th class="text-end min-w-100px">Prix Unit.</th>
                                    <th class="text-end min-w-100px">Total</th>
                                </tr>
                            </thead>
                            <tbody class="fw-bold text-gray-600">
                                {% if sales_activities %}
                                {% with currency=company_settings.currency %}
                                {% for item in sales_activities %}
                                <tr class="table-row-hover">
                                    <td>{{ item.invoice.date_issued|date:"d/m/Y" }}</td>
                                    <td><span class="badge badge-modern badge-dark">{{ item.invoice.invoice_number }}</span></td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="symbol symbol-35px symbol-circle me-2">
                                                <span class="symbol-label bg-gradient-primary text-white fw-bold">
                                                    {{ item.invoice.client.name|first|upper }}
                                                </span>
                                            </div>
                                            <span class="text-gray-800 text-hover-primary mb-1">{{ item.invoice.client.name }}</span>
                                        </div>
                                    </td>
                                    <td><span class="text-dark fw-bolder">{{ item.product.name }}</span></td>
                                    <td class="text-end">{{ item.quantity }}</td>
                                    <td class="text-end">{{ item.unit_price|format_currency:currency }}</td>
                                    <td class="text-end text-success fw-bolder">{{ item.total|format_currency:currency }}</td>
                                </tr>
                                {% endfor %}
                                {% endwith %}
                                {% else %}
                                <tr>
                                    <td colspan="7" class="text-center py-5">
                                        <div class="empty-state">
                                            <i class="fas fa-inbox fs-2tx text-primary mb-4"></i>
                                            <h4 class="text-gray-900 fw-bolder mb-2">Aucune donnée</h4>
                                            <div class="fs-6 text-gray-700">Aucune activité de vente trouvée pour cette période.</div>
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. État des Factures -->
        <div class="col-12">
            <div class="card card-modern card-flush h-xl-100">
                <div class="card-header-modern">
                    <div class="d-flex align-items-center gap-3">
                        <div class="symbol symbol-50px">
                            <span class="symbol-label bg-gradient-info">
                                <i class="fas fa-file-invoice-dollar text-white fs-2"></i>
                            </span>
                        </div>
                        <div>
                            <h3 class="card-title-modern mb-1">État des Factures</h3>
                            <span class="card-subtitle-modern">Suivi des paiements</span>
                        </div>
                    </div>
                    <div class="card-toolbar d-print-none">
                        <a href="{% url 'inventory:export_invoice_status_excel' %}?{{ request.GET.urlencode }}"
                            class="btn btn-sm btn-light-success me-2 btn-hover-scale">
                            <i class="fas fa-file-excel me-1"></i> Excel
                        </a>
                        <a href="{% url 'inventory:export_invoice_status_pdf' %}?{{ request.GET.urlencode }}"
                            class="btn btn-sm btn-light-danger btn-hover-scale" target="_blank">
                            <i class="fas fa-file-pdf me-1"></i> PDF
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Stats Cards -->
                    <div class="row g-4 mb-6">
                        <div class="col-md-4">
                            <div class="stat-card stat-card-success">
                                <div class="stat-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-label">Payées</div>
                                    <div class="stat-value">{{ invoices_paid.count }}</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card stat-card-warning">
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-label">En Attente</div>
                                    <div class="stat-value">{{ invoices_pending.count }}</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card stat-card-danger">
                                <div class="stat-icon">
                                    <i class="fas fa-exclamation-circle"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-label">En Retard</div>
                                    <div class="stat-value">{{ invoices_overdue.count }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-modern align-middle table-row-dashed fs-6 gy-3">
                            <thead>
                                <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                                    <th class="min-w-100px">N° Facture</th>
                                    <th class="min-w-150px">Client</th>
                                    <th class="min-w-100px">Date</th>
                                    <th class="min-w-100px">Échéance</th>
                                    <th class="min-w-100px">Statut</th>
                                    <th class="text-end min-w-100px">Montant</th>
                                    <th class="text-end min-w-100px">Solde</th>
                                </tr>
                            </thead>
                            <tbody class="fw-bold text-gray-600">
                                {% with currency=company_settings.currency %}
                                
                                {% for invoice in invoices_paid|slice:":10" %}
                                <tr class="table-row-hover">
                                    <td><span class="badge badge-modern badge-dark">{{ invoice.invoice_number }}</span></td>
                                    <td>{{ invoice.client.name }}</td>
                                    <td>{{ invoice.date_issued|date:"d/m/Y" }}</td>
                                    <td>{{ invoice.date_due|date:"d/m/Y" }}</td>
                                    <td><span class="badge badge-modern badge-success">{{ invoice.get_status_display }}</span></td>
                                    <td class="text-end">{{ invoice.total_amount|format_currency:currency }}</td>
                                    <td class="text-end fw-bolder">{{ invoice.get_remaining_amount|format_currency:currency }}</td>
                                </tr>
                                {% endfor %}

                                {% for invoice in invoices_pending|slice:":10" %}
                                <tr class="table-row-hover">
                                    <td><span class="badge badge-modern badge-dark">{{ invoice.invoice_number }}</span></td>
                                    <td>{{ invoice.client.name }}</td>
                                    <td>{{ invoice.date_issued|date:"d/m/Y" }}</td>
                                    <td>{{ invoice.date_due|date:"d/m/Y" }}</td>
                                    <td><span class="badge badge-modern badge-warning">{{ invoice.get_status_display }}</span></td>
                                    <td class="text-end">{{ invoice.total_amount|format_currency:currency }}</td>
                                    <td class="text-end fw-bolder text-warning">{{ invoice.get_remaining_amount|format_currency:currency }}</td>
                                </tr>
                                {% endfor %}
                                
                                {% if not invoices_paid and not invoices_pending %}
                                <tr>
                                    <td colspan="7" class="text-center py-5">
                                        <div class="text-gray-500 fs-6">Aucune facture à afficher</div>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endwith %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Répartition du Stock par Magasin -->
        <div class="col-12">
            <div class="card card-modern card-flush h-xl-100">
                <div class="card-header-modern">
                    <div class="d-flex align-items-center gap-3">
                        <div class="symbol symbol-50px">
                            <span class="symbol-label bg-gradient-primary">
                                <i class="fas fa-store text-white fs-2"></i>
                            </span>
                        </div>
                        <div>
                            <h3 class="card-title-modern mb-1">Répartition du stock</h3>
                            <span class="card-subtitle-modern">Par point de vente</span>
                        </div>
                    </div>
                    <div class="card-toolbar d-print-none">
                        <a href="{% url 'inventory:export_stock_distribution_excel' %}?{{ request.GET.urlencode }}" class="btn btn-sm btn-light-success me-2 btn-hover-scale">
                            <i class="fas fa-file-excel me-1"></i> Excel
                        </a>
                        <a href="{% url 'inventory:export_stock_distribution_pdf' %}?{{ request.GET.urlencode }}" class="btn btn-sm btn-light-danger btn-hover-scale" target="_blank">
                            <i class="fas fa-file-pdf me-1"></i> PDF
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-modern align-middle table-row-dashed fs-6 gy-3">
                            <thead>
                                <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                                    <th class="min-w-150px">Point de Vente</th>
                                    <th class="min-w-100px">Code</th>
                                    <th class="text-end min-w-100px">Nb Produits</th>
                                    <th class="text-end min-w-100px">Quantité Totale</th>
                                    <th class="text-end min-w-100px">Valeur Totale</th>
                                </tr>
                            </thead>
                            <tbody class="fw-bold text-gray-600">
                                {% if stock_by_pos %}
                                {% with currency=company_settings.currency %}
                                {% for item in stock_by_pos %}
                                <tr class="table-row-hover">
                                    <td class="text-dark fw-bolder">{{ item.point_of_sale__name }}</td>
                                    <td><span class="badge badge-modern badge-primary">{{ item.point_of_sale__code }}</span></td>
                                    <td class="text-end">{{ item.total_products }}</td>
                                    <td class="text-end text-dark">{{ item.total_quantity|default:0 }}</td>
                                    <td class="text-end text-success fw-bolder">{{ item.total_value|default:0|format_currency:currency }}</td>
                                </tr>
                                {% endfor %}
                                {% endwith %}
                                {% else %}
                                <tr>
                                    <td colspan="5" class="text-center py-5">
                                        <div class="text-gray-500 fs-6">Aucun stock disponible</div>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. Produits en Stock Faible -->
        <div class="col-12">
            <div class="card card-modern card-flush h-xl-100 card-accent-warning">
                <div class="card-header-modern">
                    <div class="d-flex align-items-center gap-3">
                        <div class="symbol symbol-50px">
                            <span class="symbol-label bg-gradient-warning">
                                <i class="fas fa-exclamation-triangle text-white fs-2"></i>
                            </span>
                        </div>
                        <div>
                            <h3 class="card-title-modern mb-1">Produits en Stock Faible</h3>
                            <span class="card-subtitle-modern">Nécessitent un réapprovisionnement</span>
                        </div>
                    </div>
                    <div class="card-toolbar d-print-none">
                        <a href="{% url 'inventory:export_low_stock_excel' %}?{{ request.GET.urlencode }}" class="btn btn-sm btn-light-success me-2 btn-hover-scale">
                            <i class="fas fa-file-excel me-1"></i> Excel
                        </a>
                        <a href="{% url 'inventory:export_low_stock_pdf' %}?{{ request.GET.urlencode }}" class="btn btn-sm btn-light-danger btn-hover-scale" target="_blank">
                            <i class="fas fa-file-pdf me-1"></i> PDF
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-modern align-middle table-row-dashed fs-6 gy-3">
                            <thead>
                                <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                                    <th class="min-w-150px">Produit</th>
                                    <th class="min-w-100px">SKU</th>
                                    <th class="min-w-150px">Point de Vente</th>
                                    <th class="text-end min-w-100px">Quantité</th>
                                    <th class="text-end min-w-100px">Seuil</th>
                                    <th class="min-w-100px">Emplacement</th>
                                </tr>
                            </thead>
                            <tbody class="fw-bold text-gray-600">
                                {% if low_stock_products %}
                                {% for item in low_stock_products %}
                                <tr class="table-row-hover">
                                    <td>
                                        <span class="text-dark fw-bolder text-hover-primary">{{ item.product.name }}</span>
                                    </td>
                                    <td><span class="badge badge-modern badge-dark">{{ item.product.sku }}</span></td>
                                    <td>{{ item.point_of_sale.name }}</td>
                                    <td class="text-end"><span class="badge badge-modern badge-warning">{{ item.quantity }}</span></td>
                                    <td class="text-end">{{ item.reorder_level }}</td>
                                    <td>{{ item.location|default:"-" }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="6" class="text-center py-5">
                                        <div class="success-state">
                                            <i class="fas fa-check-circle fs-2hx text-success mb-4"></i>
                                            <h4 class="mb-1 text-success">Tout va bien !</h4>
                                            <span>Aucun produit en stock faible actuellement.</span>
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. Derniers Mouvements de Stock -->
        <div class="col-12">
            <div class="card card-modern card-flush h-xl-100">
                <div class="card-header-modern">
                    <div class="d-flex align-items-center gap-3">
                        <div class="symbol symbol-50px">
                            <span class="symbol-label bg-gradient-info">
                                <i class="fas fa-exchange-alt text-white fs-2"></i>
                            </span>
                        </div>
                        <div>
                            <h3 class="card-title-modern mb-1">Mouvements de Stock</h3>
                            <span class="card-subtitle-modern">Historique récent</span>
                        </div>
                    </div>
                    <div class="card-toolbar d-print-none">
                        <a href="{% url 'inventory:export_stock_movements_excel' %}?{{ request.GET.urlencode }}"
                            class="btn btn-sm btn-light-success me-2 btn-hover-scale">
                            <i class="fas fa-file-excel me-1"></i> Excel
                        </a>
                        <a href="{% url 'inventory:export_stock_movements_pdf' %}?{{ request.GET.urlencode }}"
                            class="btn btn-sm btn-light-danger btn-hover-scale" target="_blank">
                            <i class="fas fa-file-pdf me-1"></i> PDF
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-modern align-middle table-row-dashed fs-6 gy-3">
                            <thead>
                                <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                                    <th class="min-w-150px">Date</th>
                                    <th class="min-w-200px">Produit</th>
                                    <th class="min-w-100px">Type</th>
                                    <th class="text-end min-w-100px">Quantité</th>
                                    <th class="min-w-150px">Point de Vente</th>
                                    <th class="min-w-150px">Utilisateur</th>
                                </tr>
                            </thead>
                            <tbody class="fw-bold text-gray-600">
                                {% if stock_movements %}
                                {% for movement in stock_movements %}
                                <tr class="table-row-hover">
                                    <td>{{ movement.created_at|date:"d/m/Y H:i" }}</td>
                                    <td class="text-dark fw-bolder">{{ movement.product.name }}</td>
                                    <td>
                                        {% if movement.movement_type == 'entry' %}
                                        <span class="badge badge-modern badge-success">
                                            <i class="fas fa-arrow-down me-1"></i> Entrée
                                        </span>
                                        {% elif movement.movement_type == 'exit' %}
                                        <span class="badge badge-modern badge-danger">
                                            <i class="fas fa-arrow-up me-1"></i> Sortie
                                        </span>
                                        {% elif movement.movement_type == 'return' %}
                                        <span class="badge badge-modern badge-warning">
                                            <i class="fas fa-undo me-1"></i> Retour
                                        </span>
                                        {% else %}
                                        <span class="badge badge-modern badge-info">
                                            <i class="fas fa-exchange-alt me-1"></i> {{ movement.get_movement_type_display }}
                                        </span>
                                        {% endif %}
                                    </td>
                                    <td class="text-end fw-bolder">{{ movement.quantity }}</td>
                                    <td>{{ movement.from_point_of_sale.name }}</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="symbol symbol-25px symbol-circle me-2">
                                                <span class="symbol-label bg-light text-gray-600 fs-8 fw-bold">
                                                    {{ movement.user.username|first|upper }}
                                                </span>
                                            </div>
                                            <span>{{ movement.user.username }}</span>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="6" class="text-center py-5">
                                        <div class="text-gray-500 fs-6">Aucun mouvement récent</div>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 6. Produits Retournés -->
        <div class="col-12">
            <div class="card card-modern card-flush h-xl-100 card-accent-info">
                <div class="card-header-modern">
                    <div class="d-flex align-items-center gap-3">
                        <div class="symbol symbol-50px">
                            <span class="symbol-label bg-gradient-purple">
                                <i class="fas fa-undo-alt text-white fs-2"></i>
                            </span>
                        </div>
                        <div>
                            <h3 class="card-title-modern mb-1">Produits Retournés</h3>
                            <span class="card-subtitle-modern">Retours clients et fournisseurs</span>
                        </div>
                    </div>
                    <div class="card-toolbar d-print-none">
                        <a href="{% url 'inventory:export_returned_products_excel' %}?{{ request.GET.urlencode }}"
                            class="btn btn-sm btn-light-success me-2 btn-hover-scale">
                            <i class="fas fa-file-excel me-1"></i> Excel
                        </a>
                        <a href="{% url 'inventory:export_returned_products_pdf' %}?{{ request.GET.urlencode }}"
                            class="btn btn-sm btn-light-danger btn-hover-scale" target="_blank">
                            <i class="fas fa-file-pdf me-1"></i> PDF
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-modern align-middle table-row-dashed fs-6 gy-3">
                            <thead>
                                <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                                    <th class="min-w-100px">Date</th>
                                    <th class="min-w-150px">Produit</th>
                                    <th class="text-end min-w-100px">Quantité</th>
                                    <th class="min-w-150px">Point de Vente</th>
                                    <th class="min-w-100px">Référence</th>
                                    <th class="min-w-200px">Notes</th>
                                </tr>
                            </thead>
                            <tbody class="fw-bold text-gray-600">
                                {% if returned_products %}
                                {% for item in returned_products %}
                                <tr class="table-row-hover">
                                    <td>{{ item.created_at|date:"d/m/Y H:i" }}</td>
                                    <td class="text-dark fw-bolder">{{ item.product.name }}</td>
                                    <td class="text-end text-info fw-bolder">{{ item.quantity }}</td>
                                    <td>{{ item.from_point_of_sale.name }}</td>
                                    <td><span class="badge badge-modern badge-dark">{{ item.reference|default:"-" }}</span></td>
                                    <td class="text-gray-500">{{ item.notes|default:"-"|truncatewords:8 }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="6" class="text-center py-5">
                                        <div class="success-state">
                                            <i class="fas fa-check-circle fs-2hx text-success mb-4"></i>
                                            <h4 class="mb-1 text-success">Aucun retour</h4>
                                            <span>Aucun produit retourné sur la période.</span>
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<style>
    /* Modern Header with Gradient */
    .modern-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.2);
        position: relative;
        overflow: hidden;
    }

    .modern-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        opacity: 0.4;
    }

    /* Premium Filter Card */
    .card-premium {
        border-radius: 16px;
        border: none;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
    }

    .card-premium:hover {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        transform: translateY(-2px);
    }

    .form-control-modern {
        border-radius: 10px;
        border: 2px solid #E4E6EF;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
        background-color: #F9F9F9;
    }

    .form-control-modern:focus {
        border-color: #009EF7;
        box-shadow: 0 0 0 0.2rem rgba(0, 158, 247, 0.15);
        background-color: #fff;
        transform: translateY(-1px);
    }

    .btn-modern {
        border-radius: 10px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .btn-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 158, 247, 0.3);
    }

    .btn-modern:active {
        transform: translateY(0);
    }

    /* Glass Badge */
    .badge-glass-primary {
        background: rgba(0, 158, 247, 0.15);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 158, 247, 0.3);
        color: #009EF7;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.875rem;
    }

    /* Modern Card Styles */
    .card-modern {
        border-radius: 16px;
        border: none;
        background: #ffffff;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04), 0 1px 3px rgba(0, 0, 0, 0.06);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
    }

    .card-modern:hover {
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1), 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-4px);
    }

    /* Card with Accent Border */
    .card-accent-warning {
        border-left: 4px solid #FFC700;
    }

    .card-accent-info {
        border-left: 4px solid #7239EA;
    }

    /* Modern Card Header */
    .card-header-modern {
        padding: 1.75rem 2rem;
        background: linear-gradient(135deg, #F9F9F9 0%, #FFFFFF 100%);
        border-bottom: 2px solid #F1F1F4;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .card-title-modern {
        font-size: 1.25rem;
        font-weight: 700;
        color: #181C32;
        margin: 0;
    }

    .card-subtitle-modern {
        font-size: 0.875rem;
        color: #7E8299;
        font-weight: 500;
    }

    /* Gradient Symbols */
    .bg-gradient-success {
        background: linear-gradient(135deg, #50CD89 0%, #3BA76D 100%);
    }

    .bg-gradient-info {
        background: linear-gradient(135deg, #009EF7 0%, #0095E8 100%);
    }

    .bg-gradient-primary {
        background: linear-gradient(135deg, #009EF7 0%, #7239EA 100%);
    }

    .bg-gradient-warning {
        background: linear-gradient(135deg, #FFC700 0%, #FFA800 100%);
    }

    .bg-gradient-purple {
        background: linear-gradient(135deg, #7239EA 0%, #5014D0 100%);
    }

    /* Stat Cards */
    .stat-card {
        border-radius: 12px;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1.25rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        opacity: 0.1;
        transition: opacity 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-4px);
    }

    .stat-card:hover::before {
        opacity: 0.15;
    }

    .stat-card-success {
        background: linear-gradient(135deg, rgba(80, 205, 137, 0.1) 0%, rgba(80, 205, 137, 0.05) 100%);
        border: 2px solid rgba(80, 205, 137, 0.3);
    }

    .stat-card-success::before {
        background: linear-gradient(135deg, #50CD89 0%, #3BA76D 100%);
    }

    .stat-card-warning {
        background: linear-gradient(135deg, rgba(255, 199, 0, 0.1) 0%, rgba(255, 199, 0, 0.05) 100%);
        border: 2px solid rgba(255, 199, 0, 0.3);
    }

    .stat-card-warning::before {
        background: linear-gradient(135deg, #FFC700 0%, #FFA800 100%);
    }

    .stat-card-danger {
        background: linear-gradient(135deg, rgba(241, 65, 108, 0.1) 0%, rgba(241, 65, 108, 0.05) 100%);
        border: 2px solid rgba(241, 65, 108, 0.3);
    }

    .stat-card-danger::before {
        background: linear-gradient(135deg, #F1416C 0%, #D9214E 100%);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
        position: relative;
        z-index: 1;
    }

    .stat-card-success .stat-icon {
        background: linear-gradient(135deg, #50CD89 0%, #3BA76D 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(80, 205, 137, 0.4);
    }

    .stat-card-warning .stat-icon {
        background: linear-gradient(135deg, #FFC700 0%, #FFA800 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(255, 199, 0, 0.4);
    }

    .stat-card-danger .stat-icon {
        background: linear-gradient(135deg, #F1416C 0%, #D9214E 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(241, 65, 108, 0.4);
    }

    .stat-content {
        flex: 1;
        position: relative;
        z-index: 1;
    }

    .stat-label {
        font-size: 0.875rem;
        color: #7E8299;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.25rem;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #181C32;
        line-height: 1;
    }

    /* Modern Table */
    .table-modern {
        border-collapse: separate;
        border-spacing: 0;
    }

    .table-modern thead tr {
        background: linear-gradient(135deg, #F9F9F9 0%, #F5F8FA 100%);
    }

    .table-modern thead th {
        border-bottom: 2px solid #E4E6EF;
        padding: 1rem;
        font-weight: 700;
        letter-spacing: 0.5px;
    }

    .table-modern tbody td {
        padding: 1rem;
        border-bottom: 1px solid #F1F1F4;
        vertical-align: middle;
    }

    .table-row-hover {
        transition: all 0.2s ease;
    }

    .table-row-hover:hover {
        background: linear-gradient(135deg, rgba(0, 158, 247, 0.03) 0%, rgba(0, 158, 247, 0.01) 100%);
        transform: scale(1.001);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    /* Modern Badges */
    .badge-modern {
        padding: 0.5rem 0.875rem;
        border-radius: 8px;
        font-size: 0.8125rem;
        font-weight: 600;
        letter-spacing: 0.3px;
        border: 1px solid transparent;
    }

    .badge-dark {
        background: linear-gradient(135deg, #3F4254 0%, #2B2D3A 100%);
        color: #ffffff;
        border-color: rgba(255, 255, 255, 0.1);
    }

    .badge-success {
        background: linear-gradient(135deg, rgba(80, 205, 137, 0.15) 0%, rgba(80, 205, 137, 0.1) 100%);
        color: #50CD89;
        border-color: rgba(80, 205, 137, 0.3);
    }

    .badge-warning {
        background: linear-gradient(135deg, rgba(255, 199, 0, 0.15) 0%, rgba(255, 199, 0, 0.1) 100%);
        color: #FFA800;
        border-color: rgba(255, 199, 0, 0.3);
    }

    .badge-danger {
        background: linear-gradient(135deg, rgba(241, 65, 108, 0.15) 0%, rgba(241, 65, 108, 0.1) 100%);
        color: #F1416C;
        border-color: rgba(241, 65, 108, 0.3);
    }

    .badge-info {
        background: linear-gradient(135deg, rgba(0, 158, 247, 0.15) 0%, rgba(0, 158, 247, 0.1) 100%);
        color: #009EF7;
        border-color: rgba(0, 158, 247, 0.3);
    }

    .badge-primary {
        background: linear-gradient(135deg, rgba(114, 57, 234, 0.15) 0%, rgba(114, 57, 234, 0.1) 100%);
        color: #7239EA;
        border-color: rgba(114, 57, 234, 0.3);
    }

    /* Button Hover Scale */
    .btn-hover-scale {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .btn-hover-scale:hover {
        transform: translateY(-2px) scale(1.05);
    }

    .btn-hover-scale:active {
        transform: translateY(0) scale(0.98);
    }

    /* Custom Button Styles */
    .btn-custom {
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        transition: all 0.3s ease;
    }

    .btn-custom:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Empty State */
    .empty-state {
        padding: 3rem 2rem;
        text-align: center;
    }

    .empty-state i {
        display: block;
        opacity: 0.5;
    }

    /* Success State */
    .success-state {
        padding: 3rem 2rem;
        text-align: center;
    }

    .success-state i {
        display: block;
    }

    /* Fade In Animation */
    .fade-in {
        animation: fadeIn 0.6s ease-in-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .modern-header {
            padding: 1.5rem;
        }

        .card-header-modern {
            padding: 1.25rem 1.5rem;
        }

        .stat-card {
            padding: 1rem;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
        }

        .stat-value {
            font-size: 1.5rem;
        }
    }

    /* Print Styles */
    @media print {
        .modern-header {
            background: #667eea !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        .card-modern {
            box-shadow: none !important;
            page-break-inside: avoid;
        }

        .table-row-hover:hover {
            background: none !important;
            transform: none !important;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Animate cards on scroll
        const cards = document.querySelectorAll('.card-modern');
        
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '0';
                    entry.target.style.transform = 'translateY(30px)';
                    
                    setTimeout(() => {
                        entry.target.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }, 100);
                    
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        cards.forEach((card, index) => {
            setTimeout(() => {
                observer.observe(card);
            }, index * 100);
        });

        // Animate stat values
        const statValues = document.querySelectorAll('.stat-value');
        statValues.forEach(stat => {
            const finalValue = parseInt(stat.textContent);
            if (!isNaN(finalValue)) {
                let currentValue = 0;
                const increment = finalValue / 30;
                const timer = setInterval(() => {
                    currentValue += increment;
                    if (currentValue >= finalValue) {
                        stat.textContent = finalValue;
                        clearInterval(timer);
                    } else {
                        stat.textContent = Math.floor(currentValue);
                    }
                }, 30);
            }
        });
    });
</script>

{% endblock %}
