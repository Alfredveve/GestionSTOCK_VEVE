{% extends 'inventory/base_auth.html' %}
{% load static %}


{% block content_auth %}
<form method="post" novalidate id="kt_verify_form">
    {% csrf_token %}

    <!-- Heading -->
    <div class="text-center mb-4">
        <div class="d-inline-flex align-items-center justify-content-center bg-success bg-opacity-10 rounded-circle p-4 mb-4" style="width: 80px; height: 80px;">
             <i class="bi bi-envelope-open fs-1 text-success"></i>
        </div>
        
        <h2 class="text-dark fw-bold mb-3">Vérification</h2>
        <div class="text-secondary small">
            Nous avons envoyé un code à <strong class="text-dark">{{ email }}</strong>.<br>
            Entrez-le ci-dessous pour continuer.
        </div>
    </div>

    <!-- Non-field errors -->
    {% if form.non_field_errors %}
    <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
        <i class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2"></i>
        <div>{{ form.non_field_errors|join:", " }}</div>
    </div>
    {% endif %}

    <!-- Code Field -->
    <div class="mb-4">
        <label for="code_input" class="form-label fw-bold">Code de vérification</label>
        <input class="form-control form-control-lg text-center fs-2 fw-bold" type="text" id="code_input"
                name="{{ form.code.name }}" autocomplete="off" placeholder="######" maxlength="6"
                style="letter-spacing: 0.5rem;"
                value="{% if form.code.value %}{{ form.code.value }}{% endif %}">
            
        <div class="form-text text-center mt-2">
            Ce code expire dans 15 minutes.
        </div>
        
        {% if form.code.errors %}
        <div class="text-danger mt-1 small text-center">
            {{ form.code.errors.0 }}
        </div>
        {% endif %}
    </div>

    <!-- Actions -->
    <div class="d-grid gap-3">
        <button type="submit" id="kt_verify_submit" class="btn btn-lg btn-nature">
            <span class="indicator-label">Vérifier le code</span>
            <span class="indicator-progress d-none">Patientez...
                <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
            </span>
        </button>  
        
        <div class="text-center">
            <span class="text-secondary small">Vous n'avez rien reçu ?</span>
            <a href="{% url 'inventory:password_reset_request' %}" class="link-primary text-decoration-none fw-semibold small ms-1">
                Renvoyer le code
            </a>
        </div>
    </div>
</form>

<script>
    document.getElementById('kt_verify_form').addEventListener('submit', function(e) {
        var btn = document.getElementById('kt_verify_submit');
        var label = btn.querySelector('.indicator-label');
        var progress = btn.querySelector('.indicator-progress');

        if(btn && label && progress){
            btn.setAttribute('disabled', 'disabled');
            label.classList.add('d-none');
            progress.classList.remove('d-none');
        }
    });
</script>
{% endblock %}
