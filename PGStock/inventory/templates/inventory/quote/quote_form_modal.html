{% load crispy_forms_tags %}

<!-- Error Handling -->
{% if form.non_field_errors %}
<div class="alert alert-dismissible bg-light-danger border border-danger border-dashed d-flex flex-column flex-sm-row w-100 p-5 mb-10">
    <i class="fas fa-exclamation-triangle fs-2hx text-danger me-4 mb-5 mb-sm-0"></i>
    <div class="d-flex flex-column pe-0 pe-sm-10">
        <h5 class="mb-1 text-danger">Erreur de création</h5>
        <span class="text-danger-emphasis">{{ form.non_field_errors|join:", " }}</span>
    </div>
</div>
{% endif %}

<!-- Hidden Management Form -->
{% if item_formset %}
    {{ item_formset.management_form }}
{% endif %}

<!-- Main Form Grid -->
<div class="d-flex flex-column gap-5">
    
    <!-- Row 1: Client & Status -->
    <div class="row g-9 mb-4">
        <div class="col-md-8">
            <label class="d-flex align-items-center fs-6 fw-bold mb-2 required text-gray-700">Client</label>
            {{ form.client }}
             {% if form.client.errors %}
                <div class="text-danger small mt-1">{{ form.client.errors|join:", " }}</div>
            {% endif %}
        </div>
        <div class="col-md-4">
             <label class="d-flex align-items-center fs-6 fw-bold mb-2 required text-gray-700">Statut</label>
             {{ form.status }}
        </div>
    </div>

    <!-- Row 2: Dates -->
    <div class="row g-9 mb-4">
        <div class="col-md-6">
            <label class="d-flex align-items-center fs-6 fw-bold mb-2 required text-gray-700">
                <span class="required">Date d'émission</span>
                <i class="fas fa-exclamation-circle ms-2 fs-7" data-bs-toggle="tooltip" title="Date de création du document"></i>
            </label>
            <div class="position-relative d-flex align-items-center">
                 <i class="fas fa-calendar-alt fs-2 position-absolute mx-4 text-gray-500"></i>
                {{ form.date_issued }}
            </div>
        </div>
        <div class="col-md-6">
            <label class="d-flex align-items-center fs-6 fw-bold mb-2 required text-gray-700">
                 Validité
                 <i class="fas fa-exclamation-circle ms-2 fs-7" data-bs-toggle="tooltip" title="Date jusqu'à laquelle l'offre est valable"></i>
            </label>
            <div class="position-relative d-flex align-items-center">
                <i class="fas fa-hourglass-end fs-2 position-absolute mx-4 text-gray-500"></i>
                {{ form.valid_until }}
            </div>
        </div>
    </div>

    <!-- Row 3: Tax Rate -->
     <div class="row g-9 mb-4">
         <div class="col-12">
            <div class="d-flex flex-stack mb-2">
                <label class="d-flex align-items-center fs-6 fw-bold text-gray-700">Taux Taxe (TVA)</label>
            </div>
            <div class="position-relative">
                {{ form.tax_rate }}
                <div class="position-absolute translate-middle-y top-50 end-0 me-3">
                    <span class="fw-bold text-gray-600">%</span>
                </div>
            </div>
            <div class="form-text text-muted">Laisser vide pour 0%</div>
         </div>
    </div>

    <!-- Row 4: Notes -->
    <div class="d-flex flex-column mb-8">
        <label class="fs-6 fw-bold mb-2 text-gray-700">Notes / Conditions</label>
        {{ form.notes }}
    </div>

</div>

<style>
    /* Professional Overrides */
    .form-control-solid, .form-select-solid {
        background-color: #f5f8fa;
        border-color: #f5f8fa;
        color: #5e6278;
        transition: color 0.2s ease, background-color 0.2s ease;
    }
    .form-control-solid:focus, .form-select-solid:focus {
        background-color: #eef3f7;
        border-color: #eef3f7;
        color: #5e6278;
    }
    /* Icons in inputs */
    .position-relative .form-control {
        padding-left: 3.5rem; /* Make space for icon */
    }
</style>
<script>
    // re-init select2 for modal
    $(document).ready(function() {
        $('#kt_modal_quote_create_form select').select2({
            dropdownParent: $('#kt_modal_quote_create'),
            theme: "bootstrap-5",
            width: '100%'
        });
    });
</script>
